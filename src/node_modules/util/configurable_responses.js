// Copyright Titanium I.T. LLC.
"use strict";

const ensure = require("util/ensure");
const type = require("util/type");

module.exports = class ConfigurableResponses {

	static create(responses, name) {
		ensure.signature(arguments, [ type.ANY_VALID, String ]);

		return new ConfigurableResponses(responses, name);
	}

	static fromObject(responseObject, name) {
		ensure.signature(arguments, [ Object, String ]);

		const entries = Object.entries(responseObject);
		const translatedEntries = entries.map(([ key, value ]) => {
			const translatedName = `${name}: ${key}`;
			return [ key, ConfigurableResponses.create(value, translatedName )];
		});
		return Object.fromEntries(translatedEntries);
	}

	constructor(responses, name) {
		ensure.signature(arguments, [ type.ANY_VALID, String ]);

		this._name = name;
		this._responses = Array.isArray(responses)
			? [ ...responses ]
			: responses;
	}

	next() {
		ensure.signature(arguments, []);

		const response = Array.isArray(this._responses)
			? this._responses.shift()
			: this._responses;

		if (response === undefined) throw new Error(`No more responses configured in ${this._name}`);
		return response;
	}

};